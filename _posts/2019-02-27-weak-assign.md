---
layout:     article
title:      "使用assign修饰对象？"
subtitle:   "别想了，肯定会有闪退"
date:       2019-02-26 19:00:00
key:        1012
tags:
    - iOS疑问
---
### 前言
前几天公司的项目中遇到了一个奇怪的问题，大致就是在`Release`版本下测试，程序总会闪退，`Debug`环境下正常。最后发现一个同事手误用`assign`修饰了OC对象所导致的。
<!--more-->
然后这引起我的一些思考，以前只是知道`assign`用于修饰基本数据类型，但是为什么`assign`一般用于修饰基本数据类型？`assign`其实也可以用来修饰对象。那么我们为什么不用它修饰对象呢？

- `assign`是指针赋值，被`assign`修饰的对象, 在释放之后，指针的地址还是存在的，也就是说指针并没有被置为`nil`，造成野指针。而且对象一般分配在堆上的某块内存，如果在后续的内存分配中，刚好分到了这块地址，程序就会崩溃掉。
- `assign`仅仅完成一个变量赋值的操作，当`assign`修饰`@property`时，它会告诉编译器如何合成属性的`setter`实现，基础数据类型一般分配在栈上，栈的内存会由系统自己自动处理，不会造成野指针。

### 那么为什么`Debug`版本和`Release`版本会出现两种不同的结果??
我猜测可能和两种版本的内存管理有关，`release`版本的内存内部管理更加严格，只要对象达到释放条件，会立即释放，而在`debug`环境下，对象的释放可能会延迟，或者说是没有完全释放，所以`release`环境下释放出来的空间立即被使用，就会导致程序崩溃，不过这也仅仅是猜测。如果你有更多的解释，欢迎讨论~

### 参考：
http://blog.csdn.net/sinat_30162391/article/details/50667087  
http://stackoverflow.com/a/15541801/5353887  
http://www.jianshu.com/p/3e0f12e5faaa